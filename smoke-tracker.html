<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ========================== METADATA & BROWSER CONFIG ========================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoke Tracker - IDKY Retro</title>

    <!-- ========================== STYLESHEETS & FONTS ========================== -->
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Inline styles for this specific page -->
    <style>
        /* --- Base & Existing Styles (Modal, Timer, Limits, Log Items, Toolbar etc.) --- */
        /* ... (Keep ALL your existing inline styles from the previous version here) ... */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 3000; animation: fadeInBg 0.3s ease; }
        .modal-overlay.show { display: flex; }
        .modal-content { background-color: var(--theme-card-bg); padding: 20px; border: var(--pixel-border-width) solid var(--theme-border-main); box-shadow: 4px 4px 0 var(--theme-primary-dark); width: 90%; max-width: 450px; animation: zoomInModal 0.3s ease-out; color: var(--theme-text-main); }
        .modal-content h3 { font-size: 20px; margin-bottom: 15px; color: var(--theme-primary-accent); text-align: center; border-bottom: 1px dashed var(--theme-primary-accent); padding-bottom: 8px; }
        .modal-content textarea { width: 100%; min-height: 80px; padding: 8px; margin-bottom: 15px; border: var(--pixel-border-width) solid var(--theme-border-main); font-family: 'VT323', monospace; font-size: 18px; resize: vertical; background-color: var(--theme-light-bg); color: var(--theme-text-main); outline: none; }
        .modal-actions { display: flex; justify-content: space-around; }
        .modal-actions button { padding: 8px 15px; font-family: 'VT323', monospace; font-size: 16px; border: var(--pixel-border-width) solid var(--theme-primary-dark); cursor: pointer; box-shadow: 1px 1px 0px var(--theme-primary-dark); transition: all 0.1s ease; min-width: 100px; }
        .modal-actions button#saveReasonButton { background-color: var(--theme-primary-accent); color: var(--theme-card-bg); }
        .modal-actions button#cancelReasonButton { background-color: #aaa; color: var(--theme-primary-dark); }
        .add-reason-icon { cursor: pointer; margin-left: 8px; color: var(--theme-tertiary-accent); font-size: 16px; transition: color 0.2s, transform 0.2s; vertical-align: middle; }
        .add-reason-icon.has-reason { color: var(--theme-primary-accent); }
        .timer-display { font-size: 28px; background-color: var(--theme-primary-dark); color: var(--theme-text-on-dark); padding: 5px 10px; border: var(--pixel-border-width) solid var(--theme-primary-accent); margin: 10px auto; text-align: center; width: fit-content; min-width: 80px; box-shadow: inset 1px 1px 0px rgba(0,0,0,0.4); }
        .timer-display.counting-down { border-color: var(--theme-secondary-accent); }
        .timer-display.warning { animation: pulseWarning 1s infinite; border-color: var(--theme-highlight-accent); }
        @keyframes pulseWarning { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .limit-setting label { font-size: 16px; margin-right: 5px; }
        .limit-setting input[type="text"], .limit-setting input[type="number"] { width: 70px; padding: 4px; font-family: 'VT323', monospace; font-size: 16px; border: var(--pixel-border-width) solid var(--theme-border-main); background-color: var(--theme-light-bg); color: var(--theme-text-main); text-align: center; }
        .over-limit { color: var(--theme-highlight-accent) !important; font-weight: bold; }
        .log-item-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px; }
        .log-item-details { display: flex; align-items: center; flex-grow: 1; }
        .log-item-time { font-size: 14px; color: #666; white-space: nowrap; }
        .log-item-reason-icon-container { text-align: right; }
        .shop-toolbar-fixed { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--theme-primary-dark); color: var(--theme-text-on-dark); border-top: var(--pixel-border-width) solid var(--theme-border-main); box-shadow: 0 -2px 5px rgba(0,0,0,0.2); z-index: 1000; }
        .shop-toolbar-header-link { display: flex; justify-content: space-between; align-items: center; padding: 8px 15px; font-size: 18px; color: var(--theme-text-on-dark); text-decoration: none; cursor: pointer; }
        .shop-toolbar-header-link:hover { background-color: color-mix(in srgb, var(--theme-primary-dark) 85%, white); }
        .shop-toolbar-header-link i { margin-right: 5px; }
        .shop-pts-display { font-size: 16px; margin-left: auto; margin-right: 15px; }
        @keyframes fadeInBg { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomInModal { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pointsFlash { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); color: var(--theme-secondary-accent); } }
        #particleCanvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1; }


        /* --- NEW: Journal Modal Styles --- */
        #journalModalOverlay {
            /* Uses .modal-overlay styles but with a higher z-index if needed, or keep same */
            z-index: 3500; /* Ensure it's above other modals if any */
        }
        #journalModalContent {
            /* Uses .modal-content styles, but wider and taller */
            max-width: 90vw; /* Wider */
            width: 650px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: var(--pixel-border-width) dashed var(--theme-primary-accent);
        }
        .journal-header h2 {
            font-size: 22px;
            color: var(--theme-primary-accent);
            margin: 0;
        }
        .journal-nav button {
            background: var(--theme-secondary-accent);
            color: var(--theme-primary-dark);
            border: var(--pixel-border-width) solid var(--theme-primary-dark);
            padding: 5px 10px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
            box-shadow: 1px 1px 0 var(--theme-primary-dark);
        }
        .journal-nav button:hover { filter: brightness(1.1); }
        .journal-calendar-area {
            margin-bottom: 15px;
        }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Equal column widths */
        }
        .calendar-table th, .calendar-table td {
            border: var(--pixel-border-width) solid var(--theme-border-main);
            padding: 5px;
            text-align: center;
            vertical-align: top;
            height: 60px; /* Min height for day cells */
            font-size: 14px;
        }
        .calendar-table th {
            background-color: var(--theme-light-bg);
            color: var(--theme-text-main);
            font-size: 16px;
        }
        .calendar-day-cell {
            cursor: default;
            position: relative; /* For icon positioning */
        }
        .calendar-day-cell.has-logs {
            cursor: pointer;
            background-color: var(--theme-card-bg);
        }
        .calendar-day-cell.has-logs:hover {
            background-color: color-mix(in srgb, var(--theme-card-bg) 90%, var(--theme-primary-accent) 20%);
        }
        .calendar-day-cell.other-month {
            color: #aaa;
            background-color: var(--theme-light-bg) !important; /* Force different bg for non-current month days */
            cursor: default !important;
        }
        .day-number {
            display: block;
            font-size: 16px;
            margin-bottom: 3px;
        }
        .day-log-icon {
            font-size: 20px; /* Adjust icon size */
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        .day-log-icon.exceeded { color: var(--theme-highlight-accent); } /* Red */
        .day-log-icon.under-limit { color: var(--theme-primary-accent); } /* Green */
        .day-log-icon.met-limit { color: var(--theme-secondary-accent); } /* Yellow/Orange */

        .journal-daily-logs-area {
            border-top: var(--pixel-border-width) dashed var(--theme-tertiary-accent);
            padding-top: 15px;
            flex-grow: 1; /* Allows this area to take remaining space */
            overflow-y: auto; /* Scroll for daily logs if many */
            max-height: 250px; /* Limit height if calendar takes much space */
        }
        .journal-daily-logs-area h4 {
            font-size: 18px;
            color: var(--theme-primary-dark);
            margin-bottom: 10px;
        }
        .journal-daily-logs-area .moments-list { /* Reuse existing list style */
            padding-left: 0; /* Override if needed */
        }
        .journal-daily-logs-area .no-logs-for-day {
            text-align: center;
            color: #888;
            padding: 10px;
        }
        .journal-close-button {
            margin-top: 15px;
            padding: 8px 15px;
            font-size: 16px;
            background-color: var(--theme-tertiary-accent);
            color: var(--theme-card-bg);
            border: var(--pixel-border-width) solid var(--theme-primary-dark);
            box-shadow: 1px 1px 0 var(--theme-primary-dark);
            cursor: pointer;
            display: block; /* Make it block to center with margin auto */
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .view-all-logs-button { /* Style for the button below recent logs */
            display: block; /* Or inline-block */
            margin: 15px auto 0 auto; /* Center it */
            padding: 8px 15px;
            font-size: 16px;
            background-color: var(--theme-secondary-accent);
            color: var(--theme-primary-dark);
            border: var(--pixel-border-width) solid var(--theme-primary-dark);
            box-shadow: 1px 1px 0 var(--theme-primary-dark);
            cursor: pointer;
            text-align: center;
        }
        .view-all-logs-button:hover { filter: brightness(1.1); }
    </style>
</head>
<body>
    <!-- ========================== PARTICLE CANVAS ========================== -->
    <canvas id="particleCanvas"></canvas>

    <!-- ========================== MAIN APP CONTAINER ========================== -->
    <div class="app-container" style="padding-bottom: 70px;">

        <!-- SECTION: HEADER (Title & Stats) -->
        <div class="header-section"> <!-- ... (Header content as before) ... --> </div>

        <!-- SECTION: MAIN TRACKER CONTENT -->
        <div class="smoke-tracker-content">
            <!-- SUB-SECTION: Cigarette Logging -->
            <div class="log-actions-section moment-card" style="padding: 15px; margin-bottom: 15px; text-align: center;"> <!-- ... (Button as before) ... --> </div>

            <!-- SUB-SECTION: Vape Timer -->
            <div class="vape-timer-section moment-card" style="padding: 15px; margin-bottom: 15px; text-align: center;"> <!-- ... (Vape timer as before) ... --> </div>

            <!-- SUB-SECTION: Daily Status & Limits -->
            <div class="status-limit-section moment-card" style="padding: 10px; margin-bottom: 15px;"> <!-- ... (Status & Limits as before) ... --> </div>

            <!-- SUB-SECTION: Log History -->
            <div class="log-history-section">
                <h2 style="text-align: center; color: var(--theme-secondary-accent); font-size: 20px; margin-bottom: 10px;">RECENT LOG</h2>
                <ul class="moments-list" id="smokeLogList">
                    <li class="moment-card no-items-placeholder" id="noLogsPlaceholder" style="padding: 15px; text-align: center; color: #888; display: none;">NO LOGS YET TODAY</li>
                </ul>
                <!-- NEW: View All Logs Button -->
                <button class="view-all-logs-button" id="viewAllLogsButton" style="display: none;">
                    <i class="fas fa-book-open"></i> VIEW ALL LOGS
                </button>
            </div>

            <!-- SUB-SECTION: Progress Overview -->
            <div class="progress-section moment-card" style="padding: 10px; margin-top: 20px; text-align: center; background-color: var(--theme-light-bg);"> <!-- ... (Progress as before) ... --> </div>
        </div>
    </div>

    <!-- ========================== SHOP TOOLBAR LINK ========================== -->
     <div class="shop-toolbar-fixed" id="shopToolbar"> <!-- ... (Toolbar link as before) ... --> </div>

    <!-- ========================== REASON INPUT MODAL ========================== -->
    <div class="modal-overlay" id="reasonModalOverlay"> <!-- ... (Reason modal as before) ... --> </div>

    <!-- ========================== NEW: JOURNAL MODAL ========================== -->
    <div class="modal-overlay" id="journalModalOverlay">
        <div class="modal-content" id="journalModalContent">
            <div class="journal-header">
                <h2 id="journalMonthYear">Log Journal</h2>
                <div class="journal-nav">
                    <button id="journalPrevMonth"><i class="fas fa-chevron-left"></i> PREV</button>
                    <button id="journalNextMonth">NEXT <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <div class="journal-calendar-area">
                <table class="calendar-table">
                    <thead>
                        <tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>
                    </thead>
                    <tbody id="journalCalendarBody">
                        <!-- Calendar days will be generated by JS -->
                    </tbody>
                </table>
            </div>

            <div class="journal-daily-logs-area">
                <h4 id="journalSelectedDayHeader">Select a day to view logs.</h4>
                <ul class="moments-list" id="journalDailyLogList">
                    <!-- Daily logs will be rendered here -->
                </ul>
                <div class="no-logs-for-day" id="journalNoLogsForDay" style="display: none;">No logs recorded for this day.</div>
            </div>

            <button class="journal-close-button" id="journalCloseButton">CLOSE JOURNAL</button>
        </div>
    </div>
    <!-- END ========================== NEW: JOURNAL MODAL ========================== -->

    <!-- ========================== TOAST NOTIFICATION ========================== -->
    <div class="toast-notification" id="toastNotification">Toast message</div>

    <!-- ========================== SCRIPT FILE ========================== -->
    <script src="smoke-tracker-script.js"></script>
</body>
</html>
